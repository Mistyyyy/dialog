<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>弹出层插件</title>
  <link rel="stylesheet" href="dialog.css">
</head>
<body>
  
  <!-- 第一种实现方式就是有一个额外的标签来充当遮罩层 因为多了一个标签，语义化不明确，所以不推荐 -->
  <button>show</button>
  
<script>
  {
    function showDialog(){

      function addDom(){
        let container = document.createDocumentFragment()
        let modal = document.createElement('div')
        modal.classList.add('modal','fade')
        modal.innerHTML = `
        <div class="modal-shadow fade in"></div>
        <div class="modal-dialog flex-show vertical-center">
          <header class="header"></header>
          <main class="main"></main>
          <footer class="footer"></footer>
        </div>
        `
        container.append(modal)
        return container
      }
      
      function containerTransitionEnd(){
        removeEvent(this,'transitionend',containerTransitionEnd)
        document.body.removeChild(this)
      }


      function clickHandle(){
        if(event.target === $$('.modal-shadow')){
          $$('.modal').classList.remove('in')
          EventListener($$('.modal'),'transitionend',containerTransitionEnd)
          removeEvent(this,'click',clickHandle)
        }
      }
      // 添加DOM
      document.body.append(addDom())
      // 给新增DOM添加in属性，触发transition效果
      window.setTimeout(()=>{
        $$('.modal').classList.add('in')
      })

      EventListener(document,'click',clickHandle)
    }
    function $$(elem,context = document) {
      return context.querySelector(elem)
    }
    // 事件绑定
    function EventListener(elem,type,fb){
      elem.addEventListener(type,fb);
    }
    // 事件移除
    function removeEvent(elem,type,fb){
      elem.removeEventListener(type,fb)
    }

    // 点击显示按钮
    let btn = $$('button')
    EventListener(btn,'click',showDialog)
  }
 
 
</script>
</body>
</html>