<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>弹出层插件</title>
  <link rel="stylesheet" href="dialog.css">
</head>
<body>
  <!-- 第一种实现方式就是有一个额外的标签来充当遮罩层 因为多了一个标签，语义化不明确，所以不推荐 -->
  <div class="buttonContainer">
      <button class="showDialog">dialog</button>
  </div>
  <div class="lightBox">
    <div class="header">
      这是弹出层的头部
      <button class="close">X</button>
    </div>
    <div class="body">
      这是弹出层的内容
    </div>
    <div class="footer">
      <button class="cancel showDialog">cancel</button>
      <button class="showDialog">save</button>
    </div>
  </div>
  <!-- 弹出层的盅罩 -->
  <div class="overlay"></div>
<script>
  // 弹出层
  function showDialog() {

    let doc = document
    let dialog = $$('.lightBox')
    let overlay = $$('.overlay')
    let cancel = $$('.cancel')
    let close = $$('.close')

    //弹出层过渡结束状态的处理函数
    function dialogBackward(){
      this.classList.remove('dialogIndex')
      removeEvent(this,'transitionend',dialogBackward)
    }
    //遮罩层过渡结束状态的处理函数
    function overlayBackward(){
      this.classList.remove('overlayIndex')
      removeEvent(this,'transitionend',overlayBackward)
    }
    // 弹出层打开后对事件的监听函数 点击的逻辑问题都会放在这里
    function showDialogClick(){
      let _target = event.target
      if(_target === close || _target === cancel || _target === overlay){
        dialog.classList.remove('show')
        EventListener(dialog,'transitionend',dialogBackward)
        overlay.classList.remove('show')
        EventListener(overlay,'transitionend',overlayBackward)
        removeEvent(doc,'click',showDialogClick)
      }
    }
    // 事件绑定的封装函数
    function EventListener(elem,type,fb){
      elem.addEventListener(type,fb);
    }
    // 事件移除
    function removeEvent(elem,type,fb){
      elem.removeEventListener(type,fb)
    }
    // 简单选择器
    function $$(elem) {
      return doc.querySelector(elem)
    }
    
    // 弹出层弹出时的过渡状态
    dialog.classList.add('show','dialogIndex')
    // 遮罩弹出时的过渡状态
    overlay.classList.add('show','overlayIndex')
    // 点击的处理
    EventListener(doc,'click',showDialogClick)
  }
  document.querySelector('.showDialog').addEventListener('click',function(){
    showDialog()
  })
</script>
</body>
</html>